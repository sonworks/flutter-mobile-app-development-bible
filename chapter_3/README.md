# Chapter 3 - ウィジェット

 * ウィジェットはFlutterアプリケーションを構築する基本的な要素
 * UIほとんどをウィジェットを用いてコードで表現することは、Flutterの大きな特徴の１つ

## ウィジェットの基礎知識

### StatelessWidget

状態(State)を持たないウィジェットで、変化のある画面を実装することはできない。

### StatefulWidget

StatelessWidgetとは異なり、変化のある画面を実装することができる。
StatefulWidgetは、 `Widget` と `State` ２つのクラスから成り立っている。

| 種別 | 役割 | サンプルでのクラス名 |
| --- | --- | --- |
| Widget | Stateを作成して返す | MyApp |
| State | 状態を保持し、ウィジェットを描画する | _MyAppState |

## レイアウトの構築

レイアウトにウィジェットを配置する流れ（基本）
1. メインとなるウィジェットを記述
1. メインのウィジェットをレイアウトウィジェット内に配置
1. レイアウトウィジェットをページに追加
    1. マテリアルデザインの場合
    1. 非マテリアルデザインの場合

マテリアルデザインを使用しない場合、デフォルトでAppBarやタイトル、背景色もない状態となるため、これらの要素が必要な場合は自身で実装する必要がある。

### build
Flutterアプリケーションは自身がウィジェットで、ほとんどのウィジェットは build メソッドを持っている。
build メソッドでウィジェットをインスタンス化して返すと、ウィジェットが表示される。

### Widgets

#### Scaffold
Material Designのアプリでは一般的に使用されるウィジェット。
標準のバナーや背景色を提供、また一般的な要素を追加するAPIも提供している。

#### Center
子Widgetを親Widgetの中心に配置する。

#### MeterialApp
アプリ全体で共通テーマなどををMaterialデザインに近づける構造のUIを提供する

#### Row / Column
行、列で子Widgetを配置する

#### Expanded
行内や列内に収まりきらない子Widgetを収まることができる。
また、flexプロパティを使って特定要素のサイズを変更することもできる。

### アセットの準備

Flutterアプリでアセットファイルを取り扱うためには設定が必要である。

例）imagesディレクトリ直下のファイルをアセットとして取り扱う場合
```yaml
# pubspec.yaml
flutter:
  assets:
    - images/ # 追加
```

## ウィジェットの種類

ウィジェットは大きく、汎用的な `widgets library` に属するものと、 `Material library` に属するものと分類できる。<br>
また、iOS風のデザインを実装するウィジェットとして `Cupertino (iOS-style) widgets` が使用できる。

### `widgets library` に属するウィジェット
どのようなアプリでも使用できる
- `Container` : 基本的なウィジェットとして､子のウィジェットを綺麗に配置するなどに用いる
- `GridView` : 2次元のリストとして配置するウィジェット
- `ListView` : スクロール可能型ウィジェット（Flutterでは、ウィジェットの中身は基本スクロール不可）
- `Stack` : ベースとなるウィジェットの上に、別のウィジェットを重ねて配置するためのウィジェット
### `Material library` に属するウィジェット
MaterialAppを使用したアプリでのみ使用できる
- `Card` : 関連する複数の情報をひとまとめに表示する場合によく利用される
- `ListTile` : 最大3行のテキストと左右の要素（アイコン等）で構成されるデザインを簡単に実現できる

## 画面遷移とウィジェットの状態管理

### 画面遷移
Flutterでは画面を「ルート(route)」、ルート同士の行き来を「ナビゲーション」と呼ぶ。

> ルートはAndroidにおけるActivity、iOSにおけるViewControllerに相当するもので、Flutterでは単なるウィジェットである。

#### 新しい画面への遷移と前の画面への遷移

もっとも基本的な遷移方法である。

 * Navigator.push : 新しいルートに遷移させる
   + Navigatorが管理するルートのスタックに指定されたrouteインスタンスを追加する
 * Navigator.pop : 前の画面へ遷移させる
   + Navigatorが管理するルートのスタックから現在のrouteのインスタンスを削除する

#### 名前付きルートによる遷移

同じ画面に遷移する場合が多々ある場合に使用する。

> この方法ではコードの重複が大量に発生してしまうため「名前付きルート(Named route)」を使用してこの問題を解決できる。

 * Navigator.pushNamed : 名前付きルートに遷移させる
 * Navigator.pop : 前の画面へ遷移させる

#### ウィジェットアニメーションを伴う遷移

Heroウィジェットを使用することで、アニメーションを伴う画面遷移が可能である。

画面間でアニメーション￥させたいウィジェットを `Hero` ウィジェットでラップして使う。<br>Hero ウィジェットは tag と child が必要。
* tag: Hero を識別するウィジェット。遷移前後の画面で同じにする必要がある
* child: 遷移時に画面をまたいでアニメーションさせるウィジェット。
```dart
Hero(
  tag: 'imageHero',
  child: Image.network('https://picsum.photos/250?image=9')
);
```

#### StatefulWidget

ユーザー操作に従って変更された状態を保持する画面構築に用いる。

主なStatefulWidgetの利用パターン
* ウィジェット自身で状態を管理するパターン
  - 穂kのウィジェットから操作する必要ない、内部的な状態はウィジェット自身で管理する
* 親ウィジェットで状態を管理するパターン
  - 親ウィジェットが状態を管理して、変更が必要になった時点で子ウィジェットを作り直す
* ウィジェット自身と親の両方で状態を管理するパターン

### アセット管理とアニメーション

#### アセットの管理

Flutterで利用可能なアセットは「JSON、manifestファイル、アイコン、画像(JPEG, WebP, GIF, PNGなど)」がある。

* Asset bundle
  - ビルド時に指定されたアセットが配置される特別な領域
* Asset variant
  - Flutterでサポートしているビルドプロセス
  - 1つのアセットに複数のバージョンを持たせることが可能

##### アセットの指定
Flutterでアプリに必要なアセットは、 `pubspec.yaml` で指定する。

* コード例1、特定ファイルのアセットを読み込む場合
```dart
flutter:
    assets:
      - assets/icon.png
      - assets/background.png
```

* コード例2、特定ディレクトリにある全てアセットを読み込む場合
>ただし、この指定方法では、指定ディレクトリ直下のアセットのみが対象であることを注意する。
サブディレクトリのアセットも追加したい場合、それぞれを指定する必要がある。
```dart
flutter:
    assets:
      - assets/
```

#### アニメーションの基本

* Animation
  - アニメーションの状態を保持するクラス
* AnimationController
  - アニメーションの進捗に応じてvalueを生成するクラス
  - valueの範囲は 0.0~1.0 までの間を指定された duration 値（秒数）をかけて、線形的に（一定速度で）変化する
* CurvedAnimation
  - 非線形（一定速度ではない）な動きのアニメーションを表現するクラス
* Tween
  - AnimationControllerとは異なる範囲の数値や、数値以外のデータ型の値が必要な場合に使用
* Listener, StatusListener
  - アニメーションの変化による状態通知用リスナー

#### アニメーションの描画

* AnimatedWidget
  - Animationオブジェクトの状態変化を監視し、ウィジェットの再描画を自動的に実行
    - 明示的に setState を呼び出すコードは不要になり、より簡潔なコードの実装が可能
